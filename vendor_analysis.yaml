entity: model/Transform:v1
name: Vendor Performance Analysis
identifier: vendor-performance-analysis
description: Analyze vendor performance across products, sales, and ratings
tags:
- monthly
database: Sample Database
target:
  type: table
  name: vendor_performance
source: |
  SELECT 
      p.vendor,
      COUNT(DISTINCT p.id) as total_products,
      AVG(p.price) as avg_product_price,
      AVG(p.rating) as avg_product_rating,
      COUNT(o.id) as total_orders,
      SUM(o.quantity) as total_units_sold,
      SUM(o.total) as total_revenue,
      AVG(o.total) as avg_order_value,
      COUNT(DISTINCT o.user_id) as unique_customers,
      COUNT(DISTINCT p.category) as categories_covered,
      CASE 
          WHEN AVG(p.rating) >= 4.5 AND SUM(o.total) >= 10000 THEN 'premium'
          WHEN AVG(p.rating) >= 4.0 AND SUM(o.total) >= 5000 THEN 'established'
          WHEN AVG(p.rating) >= 3.5 AND SUM(o.total) >= 1000 THEN 'growing'
          ELSE 'emerging'
      END as vendor_tier
  FROM PRODUCTS p
  LEFT JOIN ORDERS o ON p.id = o.product_id
      AND o.created_at >= CURRENT_DATE - INTERVAL '90 days'
  GROUP BY p.vendor
  HAVING COUNT(DISTINCT p.id) > 0
  ORDER BY total_revenue DESC NULLS LAST
